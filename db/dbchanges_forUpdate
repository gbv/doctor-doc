-- Revision 85

-- add an 'open' countryCode field

ALTER TABLE `lieferanten` ADD `countryCode` VARCHAR( 2 ) NOT NULL AFTER `lieferant` ;

-- migrate existing entries from hardcoded fields

UPDATE `lieferanten` SET `countryCode` = 'CH' WHERE `lieferanten`.`CH` =1 ;

UPDATE `lieferanten` SET `countryCode` = 'AT' WHERE `lieferanten`.`A` =1 ;

UPDATE `lieferanten` SET `countryCode` = 'DE' WHERE `lieferanten`.`D` =1 ;

-- drop hardcoded fields

ALTER TABLE `lieferanten`
  DROP `D`,
  DROP `A`,
  DROP `CH`;
  
-- migrate existing entries from hardcoded fields in table konto
  
UPDATE `konto` SET `land` = 'CH' WHERE `konto`.`land` LIKE 'Schweiz' ;

UPDATE `konto` SET `land` = 'DE' WHERE `konto`.`land` LIKE 'Deutschland' ;

UPDATE `konto` SET `land` = 'AT' WHERE `konto`.`land` LIKE 'Österreich' ;

UPDATE `konto` SET `land` = 'FR' WHERE `konto`.`land` LIKE 'France' ;

UPDATE `konto` SET `land` = 'IT' WHERE `konto`.`land` LIKE 'Italien' ;

UPDATE `konto` SET `land` = 'OT' WHERE `konto`.`land` LIKE '%other%' ;

-- shrink field size to what is needed

ALTER TABLE `konto` CHANGE `land` `land` VARCHAR( 2 ) CHARACTER SET utf8 COLLATE utf8_unicode_ci NOT NULL ;

-- migrate existing entries from hardcoded fields in table benutzer

UPDATE `benutzer` SET `land` = 'CH' WHERE `benutzer`.`land` LIKE 'Schweiz' ;

UPDATE `benutzer` SET `land` = 'DE' WHERE `benutzer`.`land` LIKE 'Deutschland' ;

UPDATE `benutzer` SET `land` = 'AT' WHERE `benutzer`.`land` LIKE 'Österreich' ;

UPDATE `benutzer` SET `land` = 'IT' WHERE `benutzer`.`land` LIKE 'Italien' ;

UPDATE `benutzer` SET `land` = 'FR' WHERE `benutzer`.`land` LIKE 'France' ;

UPDATE `benutzer` SET `land` = 'GB' WHERE `benutzer`.`land` LIKE 'England' ;

UPDATE `benutzer` SET `land` = 'OT' WHERE `benutzer`.`land` LIKE '%other%' ;

-- shrink field size to what is needed

ALTER TABLE `benutzer` CHANGE `land` `land` VARCHAR( 2 ) CHARACTER SET utf8 COLLATE utf8_unicode_ci NULL DEFAULT NULL 


-- optimize table iso_countries

UPDATE `iso_countries` SET `countryCode` = 'OT' WHERE `countryName` LIKE '%other%' ;


-- Revision 56

ALTER TABLE `issn` CHANGE `identifier_id` `identifier_id` VARCHAR( 20 ) NOT NULL 

DROP TABLE `ezb_id`


CREATE TABLE IF NOT EXISTS `zdb_id` (
  `ZID` bigint(20) NOT NULL AUTO_INCREMENT,
  `identifier` varchar(20) NOT NULL,
  `identifier_id` varchar(20) NOT NULL,
  `zdbid` varchar(20) NOT NULL,
  PRIMARY KEY (`ZID`),
  KEY `identifier` (`identifier`),
  KEY `zdbid` (`zdbid`),
  KEY `identifier_id` (`identifier_id`)
) ENGINE=MyISAM  DEFAULT CHARSET=latin1;



-- Revision 50

-- introduce institutional logo/image on orderforms

ALTER TABLE `konto` ADD `instlogolink` VARCHAR( 254 ) NULL DEFAULT NULL AFTER `ezbid` 


-- Revision 38

-- add timezone support

ALTER TABLE `konto` ADD `timezone` VARCHAR( 50 ) NULL DEFAULT NULL AFTER `land` 


-- Revision 9

-- New orderstate "zu bestellen" (don't change expression: will be translated automatically)

INSERT INTO `text` (
`TID` ,
`KID` ,
`TYID` ,
`inhalt`
)
VALUES (
NULL , NULL , '2', 'zu bestellen'
);

-- boolean value to specify if orders from orderform shall be saved in DB

ALTER TABLE `bestellform_param` ADD `saveorder` TINYINT( 1 ) NOT NULL AFTER `kennung` ;

-- use same length in bestellungen.deloptions as bestellform_param.lieferart_value

ALTER TABLE `bestellungen` CHANGE `deloptions` `deloptions` VARCHAR( 50 ) CHARACTER SET utf8 COLLATE utf8_unicode_ci NOT NULL ;